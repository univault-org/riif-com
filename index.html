<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MarkVault Starter</title>

    <script>
      window.BASE_URL =
        window.location.hostname === "localhost" ? "" : "/MarkVault";
    </script>
    <!-- React and ReactDOM -->
    <script
      crossorigin
      src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"
    ></script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone@7.23.8/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?v=3.4.1"></script>

    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />

    <!-- React Markdown and dependencies -->
    <script type="module">
      import ReactMarkdown from "https://esm.sh/react-markdown@9.0.1";
      import remarkGfm from "https://esm.sh/remark-gfm@4.0.0";

      // Make them available globally
      window.ReactMarkdown = ReactMarkdown;
      window.remarkGfm = remarkGfm;
    </script>

    <!-- Add this script to make ReactMarkdown globally available -->
    <script type="module">
      import ReactMarkdown from "https://esm.sh/react-markdown@9.0.1";
      import remarkGfm from "https://esm.sh/remark-gfm@4.0.0";

      window.ReactMarkdown = ReactMarkdown;
      window.remarkGfm = remarkGfm;
    </script>

    <script>
      // Tailwind config with dark mode enabled
      tailwind.config = {
        darkMode: "class", // This is crucial for class-based dark mode
        theme: {
          extend: {
            colors: {
              primary: {
                200: "#d9f99d",
                300: "#bef264",
                400: "#a3e635",
                500: "#84cc16",
                600: "#65a30d",
                700: "#4d7c0f",
                800: "#3f6212",
                900: "#365314",
              },
              neutral: {
                50: "#f9fafb",
                100: "#f3f4f6",
                200: "#e5e7eb",
                300: "#d1d5db",
                400: "#9ca3af",
                500: "#6b7280",
                600: "#4b5563",
                700: "#374151",
                800: "#1f2937",
                900: "#111827",
              },
            },
            typography: {
              DEFAULT: {
                css: {
                  "code::before": { content: "" },
                  "code::after": { content: "" },
                  "blockquote p:first-of-type::before": { content: "none" },
                  "blockquote p:last-of-type::after": { content: "none" },
                },
              },
            },
            keyframes: {
              fadeIn: {
                "0%": { opacity: "0", transform: "translateY(10px)" },
                "100%": { opacity: "1", transform: "translateY(0)" },
              },
              slideUpFade: {
                "0%": {
                  transform: "translateY(100%)",
                  opacity: "0",
                },
                "100%": {
                  transform: "translateY(0)",
                  opacity: "1",
                },
              },
            },
            animation: {
              fadeIn: "fadeIn 0.5s ease-out",
              slideUpFade: "slideUpFade 0.5s ease-out",
            },
          },
        },
      };
    </script>

    <!-- Add this right after Tailwind config -->
    <script>
      if (
        localStorage.theme === "dark" ||
        (!("theme" in localStorage) &&
          window.matchMedia("(prefers-color-scheme: dark)").matches)
      ) {
        document.documentElement.classList.add("dark");
      } else {
        document.documentElement.classList.remove("dark");
      }
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // For local development
        window.BASE_URL =
          window.location.hostname === "localhost" ? "" : "/MarkVault";

        console.log("BASE_URL Configuration:");
        console.log("- Hostname:", window.location.hostname);
        console.log("- BASE_URL:", window.BASE_URL);
        console.log("- Full URL:", window.location.href);
      });
    </script>
  </head>

  <body>
    <div id="root"></div>
    <script type="text/babel">
      // ===============================================
      // UTILITY FUNCTIONS
      // ===============================================
      // ===============================================
      // UTILITY FUNCTIONS
      // ===============================================

      /**
       * Fetches and parses markdown content
       * @param {string} type - Content type ('posts' or 'pages')
       * @param {string} fileName - Markdown file name
       * @returns {Promise<{content: string, metadata: Object}>}
       */
      async function fetchMarkdown(type, fileName) {
        try {
          const cleanFileName = fileName.replace(/^\/+/, "");
          const response = await fetch(`./content/${type}/${cleanFileName}`);

          console.log("Fetching markdown:", {
            type,
            fileName: cleanFileName,
            url: `./content/${type}/${cleanFileName}`,
          });

          if (!response.ok) {
            console.error(`HTTP error! status: ${response.status}`);
            throw new Error(`Failed to fetch ${fileName} (${response.status})`);
          }

          const text = await response.text();
          console.log("Fetched content:", text.substring(0, 100)); // Debug log

          // Parse frontmatter and content
          const parts = text.split("---\n");
          if (parts.length < 3) {
            return {
              content: text, // Raw markdown text instead of marked.parse
              metadata: {},
            };
          }

          const [, frontmatter, ...contentParts] = parts;
          const metadata = parseFrontmatter(frontmatter);

          return {
            content: contentParts.join("---\n"), // Raw markdown text
            metadata,
          };
        } catch (error) {
          console.error(`Error fetching markdown:`, error);
          throw error;
        }
      }

      /**
       * Parse YAML frontmatter with enhanced support for arrays and nested data
       * @param {string} frontmatter
       * @returns {Object}
       */
      function parseFrontmatter(frontmatter) {
        const metadata = {};

        frontmatter.split("\n").forEach((line) => {
          const trimmedLine = line.trim();
          if (!trimmedLine || trimmedLine.startsWith("#")) return;

          // Handle arrays in square brackets
          if (trimmedLine.includes("[") && trimmedLine.includes("]")) {
            const [key, valueString] = trimmedLine.split(":");
            if (key && valueString) {
              const arrayStr = valueString.trim();
              const items = arrayStr
                .slice(1, -1) // Remove [ ]
                .split(",")
                .map((item) => item.trim())
                .filter((item) => item.length > 0);
              metadata[key.trim()] = items;
            }
            return;
          }

          // Handle regular key-value pairs
          const [key, ...values] = trimmedLine.split(":");
          if (key && values.length) {
            const value = values.join(":").trim();
            // Convert "true" and "false" strings to booleans
            if (value.toLowerCase() === "true") metadata[key.trim()] = true;
            else if (value.toLowerCase() === "false")
              metadata[key.trim()] = false;
            // Convert number strings to numbers
            else if (!isNaN(value)) metadata[key.trim()] = Number(value);
            else metadata[key.trim()] = value;
          }
        });

        return metadata;
      }

      /**
       * Fetches all markdown files from a directory
       * @param {string} type - Content type ('posts' or 'pages')
       * @returns {Promise<string[]>} List of markdown files
       */
      async function fetchContentList(type) {
        try {
          console.log("Fetching content list for:", type);

          // Fetch directory listing
          const response = await fetch(`./content/${type}/`);
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const text = await response.text();

          // Parse HTML directory listing to find markdown files
          const parser = new DOMParser();
          const doc = parser.parseFromString(text, "text/html");
          const links = Array.from(doc.querySelectorAll("a"));

          // Filter for .md files and clean up names
          const markdownFiles = links
            .map((link) => link.getAttribute("href"))
            .filter((href) => href && href.endsWith(".md"))
            .map((href) => href.split("/").pop()); // Get just the filename

          console.log(
            `Found ${markdownFiles.length} markdown files in ${type}:`,
            markdownFiles
          );

          return markdownFiles;
        } catch (error) {
          console.error(`Error fetching ${type} list:`, error);

          // Fallback: Try to fetch known files directly
          const knownFiles =
            type === "posts"
              ? ["WHY.md", "DEPLOY-GITHUB-PAGES.md"]
              : type === "pages"
              ? ["about.md"]
              : [];

          // Verify each file exists
          const existingFiles = await Promise.all(
            knownFiles.map(async (file) => {
              try {
                const response = await fetch(`./content/${type}/${file}`);
                return response.ok ? file : null;
              } catch {
                return null;
              }
            })
          );

          return existingFiles.filter((file) => file !== null);
        }
      }

      /**
       * Custom hook for theme management
       * @returns {[boolean, Function]} [isDark, toggleTheme]
       */
      function useTheme() {
        // Initialize state based on document class
        const [isDark, setIsDark] = React.useState(
          document.documentElement.classList.contains("dark")
        );

        // Effect to sync with system theme changes
        React.useEffect(() => {
          const mediaQuery = window.matchMedia("(prefers-color-scheme: dark)");
          const handleChange = () => {
            if (!("theme" in localStorage)) {
              setIsDark(mediaQuery.matches);
              if (mediaQuery.matches) {
                document.documentElement.classList.add("dark");
              } else {
                document.documentElement.classList.remove("dark");
              }
            }
          };

          mediaQuery.addEventListener("change", handleChange);
          return () => mediaQuery.removeEventListener("change", handleChange);
        }, []);

        const toggleTheme = React.useCallback(() => {
          setIsDark((prev) => {
            const newTheme = !prev;
            if (newTheme) {
              document.documentElement.classList.add("dark");
              localStorage.theme = "dark";
            } else {
              document.documentElement.classList.remove("dark");
              localStorage.theme = "light";
            }
            return newTheme;
          });
        }, []);

        return [isDark, toggleTheme];
      }

      /**
       * Custom hook for handling client-side routing
       * @returns {string} Current route path
       */
      function useRouter() {
        const [path, setPath] = React.useState(window.location.hash || "#/");

        React.useEffect(() => {
          const handleHashChange = () => setPath(window.location.hash || "#/");
          window.addEventListener("hashchange", handleHashChange);
          return () =>
            window.removeEventListener("hashchange", handleHashChange);
        }, []);

        return path;
      }

      // ===============================================
      // GLOBAL STATE MANAGEMENT
      // ===============================================

      /**
       * Global context for managing application state
       * Provides access to posts data and loading state
       */
      const GlobalContext = React.createContext();

      /**
       * Global state provider component
       * Manages posts data fetching and state
       */
      function GlobalProvider({ children }) {
        const [posts, setPosts] = React.useState([]);
        const [pages, setPages] = React.useState([]);
        const [isLoading, setIsLoading] = React.useState(true);

        React.useEffect(() => {
          // Fetch both posts and pages
          Promise.all([
            fetchContentList("posts"),
            fetchContentList("pages"),
          ]).then(([postFiles, pageFiles]) => {
            setPosts(postFiles);
            setPages(pageFiles);
            setIsLoading(false);
          });
        }, []);

        return (
          <GlobalContext.Provider value={{ posts, pages, isLoading }}>
            {children}
          </GlobalContext.Provider>
        );
      }

      // ===============================================
      // LAYOUT COMPONENTS
      // ===============================================

      /**
       * Main layout component
       * Handles theme switching and provides consistent layout structure
       * @param {Object} props
       * @param {ReactNode} props.children - Child components to render
       */
      function Layout({ children }) {
        const [isDark, toggleTheme] = useTheme();

        return (
          <div className="min-h-screen bg-neutral-50 dark:bg-neutral-900 transition-colors duration-200">
            <nav className="bg-white dark:bg-neutral-800 shadow-sm sticky top-0 z-10 backdrop-blur-sm bg-opacity-80 dark:bg-opacity-80">
              <div className="max-w-6xl mx-auto px-4 py-4">
                <div className="flex justify-between items-center">
                  <Navigation />
                  <button
                    onClick={toggleTheme}
                    className="p-2 rounded-full hover:bg-neutral-100 dark:hover:bg-neutral-700 transition-colors"
                    aria-label="Toggle theme"
                  >
                    {isDark ? (
                      <i className="bi bi-sun-fill text-neutral-300 hover:text-neutral-100"></i>
                    ) : (
                      <i className="bi bi-moon-fill text-neutral-600 hover:text-neutral-800"></i>
                    )}
                  </button>
                </div>
              </div>
            </nav>
            <main className="max-w-6xl mx-auto px-4 py-8">{children}</main>
            <footer className="border-t border-neutral-200 dark:border-neutral-800 mt-16">
              <div className="max-w-6xl mx-auto px-4 py-8 text-center text-neutral-500 dark:text-neutral-400">
                Built with MarkVault - Preserving digital content for
                generations
              </div>
            </footer>
          </div>
        );
      }

      function Navigation() {
        const path = useRouter();

        return (
          <nav className="flex items-center justify-between w-full">
            <a href="#/" className="hover:opacity-80 transition-opacity">
              <Logo />
            </a>
            <div className="space-x-4">
              <a
                href="#/"
                className={`${
                  path === "#/"
                    ? "text-primary-600 dark:text-primary-400"
                    : "text-neutral-600 dark:text-neutral-400 hover:text-primary-600 dark:hover:text-primary-400"
                }`}
              >
                Home
              </a>
              <a
                href="#/about"
                className={`${
                  path === "#/about"
                    ? "text-primary-600 dark:text-primary-400"
                    : "text-neutral-600 dark:text-neutral-400 hover:text-primary-600 dark:hover:text-primary-400"
                }`}
              >
                About
              </a>
              <a
                href="#/posts"
                className={`${
                  path === "#/posts"
                    ? "text-primary-600 dark:text-primary-400"
                    : "text-neutral-600 dark:text-neutral-400 hover:text-primary-600 dark:hover:text-primary-400"
                }`}
              >
                Posts
              </a>
            </div>
          </nav>
        );
      }

      // ===============================================
      // SHARED COMPONENTS
      // ===============================================

      function Logo({ className = "" }) {
        return (
          <div className={`flex items-center space-x-2 ${className}`}>
            <div className="relative w-8 h-8">
              {/* Vault/Shield shape with markdown symbols */}
              <div className="absolute inset-0 flex items-center justify-center">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  className="w-full h-full"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M3 4C3 2.89543 3.89543 2 5 2H19C20.1046 2 21 2.89543 21 4V20C21 21.1046 20.1046 22 19 22H5C3.89543 22 3 21.1046 3 20V4Z"
                    className="fill-primary-500 dark:fill-primary-400"
                  />
                  {/* Markdown symbols */}
                  <path
                    d="M7 7V17H9L11 13L13 17H15V7M17 7V17"
                    stroke="white"
                    strokeWidth="1.5"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                  />
                </svg>
              </div>
            </div>
            <span className="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-neutral-800 to-neutral-600 dark:from-neutral-100 dark:to-neutral-300">
              MarkVault
            </span>
          </div>
        );
      }
      /**
       * Loading spinner component
       * Displays an animated loading indicator
       */
      function LoadingSpinner() {
        return (
          <div className="flex justify-center items-center p-8">
            <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 dark:border-primary-400"></div>
          </div>
        );
      }

      /**
       * Error message component
       * Displays error states
       * @param {Object} props
       * @param {string} props.message - Error message to display
       */
      function ErrorMessage({ message }) {
        return (
          <div className="text-center p-8">
            <i className="bi bi-exclamation-circle text-2xl text-red-500 mb-2"></i>
            <p className="text-neutral-600 dark:text-neutral-300">{message}</p>
          </div>
        );
      }

      /**
       * Card component for displaying post previews
       * @param {Object} props
       * @param {string} props.title - Post title
       * @param {string} props.date - Post date
       * @param {string} props.slug - Post identifier
       * @param {boolean} props.compact - Whether to show compact version (for home page)
       */
      function PostCard({ title, date, slug, compact = false }) {
        if (compact) {
          return (
            <div className="mb-4">
              <h3>
                <a
                  href={`#/posts/${slug}`}
                  className="no-underline text-neutral-700 dark:text-neutral-200 hover:text-primary-600 dark:hover:text-primary-400"
                >
                  {title}
                </a>
              </h3>
              <time className="text-neutral-500 dark:text-neutral-400">
                {date}
              </time>
            </div>
          );
        }

        return (
          <article className="bg-white dark:bg-neutral-800 p-6 rounded-lg shadow-sm animate-fadeIn hover:shadow-md transition-shadow">
            <h2 className="text-2xl font-bold text-neutral-800 dark:text-neutral-100">
              <a
                href={`#/posts/${slug}`}
                className="hover:text-primary-600 dark:hover:text-primary-400"
              >
                {title}
              </a>
            </h2>
            <time className="text-neutral-500 dark:text-neutral-400">
              {date}
            </time>
          </article>
        );
      }

      // ===============================================
      // PAGE COMPONENTS
      // ===============================================

      /**
       * Home page component
       * Displays welcome message and latest posts
       */
      function Home() {
        const { posts, isLoading } = React.useContext(GlobalContext);
        const [postData, setPostData] = React.useState([]);
        const [error, setError] = React.useState(null);

        React.useEffect(() => {
          if (!isLoading && posts.length > 0) {
            Promise.all(
              posts.slice(0, 3).map(async (file) => {
                try {
                  const { content, metadata } = await fetchMarkdown(
                    "posts",
                    file
                  );
                  return {
                    slug: file.replace(".md", ""),
                    title: cleanMetadata(metadata.title) || file.replace(".md", ""),
                    date: metadata.date || "Unknown date",
                  };
                } catch (err) {
                  setError("Failed to load posts");
                  return null;
                }
              })
            ).then((results) => {
              setPostData(results.filter(Boolean));
            });
          }
        }, [posts, isLoading]);

        if (error) return <ErrorMessage message={error} />;
        if (isLoading) return <LoadingSpinner />;

        const features = [
          {
            title: "Markdown Powered",
            description:
              "Write in markdown, publish with confidence. Simple and powerful.",
            icon: <i className="bi bi-markdown-fill text-3xl"></i>,
          },
          {
            title: "Dark Mode",
            description:
              "Easy on the eyes, day or night. Automatic theme switching.",
            icon: <i className="bi bi-moon-stars-fill text-3xl"></i>,
          },
          {
            title: "Lightning Fast",
            description:
              "Minimal dependencies, maximum performance. Built for speed.",
            icon: <i className="bi bi-lightning-fill text-3xl"></i>,
          },
        ];
        return (
          <div className="space-y-16">
            {/* Hero Section */}
            <section className="relative h-[500px] -mt-8 mb-16 bg-gradient-to-br from-neutral-50 to-neutral-100 dark:from-neutral-800 dark:to-neutral-900">
              <div className="absolute inset-0 overflow-hidden">
                {/* Decorative grid pattern */}
                <div className="absolute inset-0 bg-[linear-gradient(to_right,#8882_1px,transparent_1px),linear-gradient(to_bottom,#8882_1px,transparent_1px)] bg-[size:14px_24px] [mask-image:radial-gradient(ellipse_60%_50%_at_50%_0%,#000_70%,transparent_110%)]"></div>
              </div>
              <div className="relative h-full max-w-6xl mx-auto px-4">
                <div className="h-full flex flex-col justify-center items-center text-center">
                  <div className="space-y-6 max-w-3xl">
                    <h1 className="text-4xl md:text-5xl lg:text-6xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-neutral-800 to-neutral-600 dark:from-neutral-100 dark:to-neutral-300">
                      Preserve Your Digital Legacy
                    </h1>
                    <p className="text-lg md:text-xl text-neutral-600 dark:text-neutral-300">
                      A modern markdown-powered platform designed for long-term
                      content preservation
                    </p>
                    <div className="flex gap-4 justify-center pt-4">
                      <a
                        href="#/posts"
                        className="inline-flex items-center px-6 py-3 rounded-lg bg-primary-500 hover:bg-primary-600 text-white font-medium transition-colors"
                      >
                        Explore Posts
                        <i className="bi bi-arrow-right ml-2"></i>
                      </a>
                      <a
                        href="#/about"
                        className="inline-flex items-center px-6 py-3 rounded-lg bg-neutral-100 hover:bg-neutral-200 dark:bg-neutral-700 dark:hover:bg-neutral-600 text-neutral-700 dark:text-neutral-100 font-medium transition-colors"
                      >
                        Learn More
                        <i className="bi bi-info-circle ml-2"></i>
                      </a>
                    </div>
                  </div>

                  {/* Optional: Decorative elements */}
                  <div className="absolute bottom-0 left-1/2 -translate-x-1/2">
                    <i className="bi bi-chevron-down text-2xl text-neutral-400 dark:text-neutral-500 animate-bounce"></i>
                  </div>
                </div>
              </div>
            </section>

            {/* Features Section */}
            <section className="max-w-6xl mx-auto px-4">
              <h2 className="text-3xl font-bold text-center mb-12 text-neutral-800 dark:text-neutral-100">
                Why Choose MarkVault?
              </h2>
              <div className="grid md:grid-cols-3 gap-8">
                {features.map((feature) => (
                  <div
                    key={feature.title}
                    className="text-center p-6 rounded-lg bg-white dark:bg-neutral-800 shadow-sm"
                  >
                    <div className="w-12 h-12 mx-auto mb-4 text-primary-500">
                      {feature.icon}
                    </div>
                    <h3 className="text-xl font-semibold mb-2 text-neutral-800 dark:text-neutral-100">
                      {feature.title}
                    </h3>
                    <p className="text-neutral-600 dark:text-neutral-400">
                      {feature.description}
                    </p>
                  </div>
                ))}
              </div>
            </section>

            {/* Latest Posts Section */}
            <section className="max-w-6xl mx-auto px-4">
              <h2 className="text-3xl font-bold mb-8 text-neutral-800 dark:text-neutral-100">
                Latest Posts
              </h2>
              <div className="grid gap-6">
                {postData.map((post) => (
                  <PostCard key={post.slug} {...post} />
                ))}
              </div>
            </section>
          </div>
        );
      }

      function About() {
        const [pageData, setPageData] = React.useState(null);
        const [isLoading, setIsLoading] = React.useState(true);
        const [error, setError] = React.useState(null);

        React.useEffect(() => {
          async function loadAboutPage() {
            try {
              const { content, metadata } = await fetchMarkdown(
                "pages",
                "about.md"
              );
              setPageData({
                content,
                title: metadata.title || "About MarkVault",
                description: metadata.description,
                lastUpdated: metadata.lastUpdated,
              });
            } catch (err) {
              console.error("Error loading about page:", err);
              setError("Failed to load about page");
            } finally {
              setIsLoading(false);
            }
          }

          loadAboutPage();
        }, []);

        // Custom components for React Markdown
        const components = {
          h1: ({ node, ...props }) => (
            <h1
              className="text-3xl font-bold text-neutral-800 dark:text-neutral-100 mb-6"
              {...props}
            />
          ),
          h2: ({ node, ...props }) => (
            <h2
              className="text-2xl font-semibold text-neutral-700 dark:text-neutral-200 mt-8 mb-4"
              {...props}
            />
          ),
          h3: ({ node, ...props }) => (
            <h3
              className="text-xl font-medium text-neutral-600 dark:text-neutral-300 mt-6 mb-3"
              {...props}
            />
          ),
          p: ({ node, ...props }) => (
            <p
              className="text-neutral-600 dark:text-neutral-300 leading-relaxed mb-4"
              {...props}
            />
          ),
          ul: ({ node, ...props }) => (
            <ul
              className="list-disc pl-6 mb-4 text-neutral-600 dark:text-neutral-300"
              {...props}
            />
          ),
          ol: ({ node, ...props }) => (
            <ol
              className="list-decimal pl-6 mb-4 text-neutral-600 dark:text-neutral-300"
              {...props}
            />
          ),
          li: ({ node, ...props }) => <li className="mb-2" {...props} />,
          a: ({ node, ...props }) => (
            <a
              className="text-primary-600 dark:text-primary-400 hover:underline"
              {...props}
            />
          ),
        };

        const renderMarkdown = (content) => {
          if (typeof window.ReactMarkdown === "undefined") {
            console.error("ReactMarkdown is not loaded");
            return <div>Error loading markdown renderer</div>;
          }

          return (
            <window.ReactMarkdown
              components={components}
              remarkPlugins={[window.remarkGfm]}
              className="max-w-none"
            >
              {content}
            </window.ReactMarkdown>
          );
        };

        if (error) return <ErrorMessage message={error} />;
        if (isLoading) return <LoadingSpinner />;
        if (!pageData) return <ErrorMessage message="Page not found" />;

        return (
          <div className="space-y-16 animate-fadeIn">
            {/* Header Section */}
            <section className="relative bg-gradient-to-br from-neutral-50 to-neutral-100 dark:from-neutral-800 dark:to-neutral-900 py-16 -mt-8">
              <div className="absolute inset-0 overflow-hidden">
                <div className="absolute inset-0 bg-[linear-gradient(to_right,#8882_1px,transparent_1px),linear-gradient(to_bottom,#8882_1px,transparent_1px)] bg-[size:14px_24px] [mask-image:radial-gradient(ellipse_60%_50%_at_50%_0%,#000_70%,transparent_110%)]"></div>
              </div>
              <div className="relative max-w-6xl mx-auto px-4 text-center">
                <h1 className="text-4xl md:text-5xl font-bold text-neutral-800 dark:text-neutral-100 mb-4">
                  {pageData.title}
                </h1>
                {pageData.description && (
                  <p className="text-lg text-neutral-600 dark:text-neutral-300 max-w-2xl mx-auto">
                    {pageData.description}
                  </p>
                )}
              </div>
            </section>

            {/* Features Grid */}
            <section className="max-w-6xl mx-auto px-4">
              <div className="grid md:grid-cols-2 gap-6">
                {[
                  {
                    icon: "bi-markdown",
                    title: "Pure Markdown",
                    description:
                      "Write content in markdown, the universal format for structured content.",
                  },
                  {
                    icon: "bi-moon-stars",
                    title: "Dark Mode",
                    description:
                      "Easy on the eyes, automatically adapts to your system preferences.",
                  },
                  {
                    icon: "bi-lightning",
                    title: "Lightning Fast",
                    description:
                      "Minimal dependencies ensure quick loading and reliable performance.",
                  },
                  {
                    icon: "bi-shield-check",
                    title: "Future Proof",
                    description:
                      "Built with longevity in mind, your content stays accessible.",
                  },
                ].map((feature) => (
                  <div
                    key={feature.title}
                    className="bg-white dark:bg-neutral-800 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow"
                  >
                    <i
                      className={`bi ${feature.icon} text-2xl text-primary-500 mb-4`}
                    ></i>
                    <h3 className="text-xl font-semibold text-neutral-800 dark:text-neutral-100 mb-2">
                      {feature.title}
                    </h3>
                    <p className="text-neutral-600 dark:text-neutral-400">
                      {feature.description}
                    </p>
                  </div>
                ))}
              </div>
            </section>

            {/* Main Content Section */}
            <section className="max-w-6xl mx-auto px-4">
              <div className="bg-white dark:bg-neutral-800 p-8 rounded-xl shadow-sm">
                {pageData &&
                  pageData.content &&
                  renderMarkdown(pageData.content)}
              </div>
            </section>

            {/* Call to Action */}
            <section className="max-w-6xl mx-auto px-4 text-center py-16">
              <h2 className="text-3xl font-bold text-neutral-800 dark:text-neutral-100 mb-4">
                Ready to Get Started?
              </h2>
              <p className="text-neutral-600 dark:text-neutral-300 mb-8">
                Join us in building a more durable web.
              </p>
              <a
                href="#/posts"
                className="inline-flex items-center px-6 py-3 rounded-lg bg-primary-500 hover:bg-primary-600 text-white font-medium transition-colors"
              >
                Explore Posts
                <i className="bi bi-arrow-right ml-2"></i>
              </a>
            </section>
          </div>
        );
      }

      // Helper function to clean metadata values in PostList and Post components

      function cleanMetadata(value) {
        if (typeof value !== "string") return value;

        // Remove surrounding quotes if present
        const cleaned = value
          .trim()
          .replace(/^["'](.*)["']$/, "$1") // Remove surrounding quotes
          .replace(/\\"/g, '"') // Replace escaped quotes
          .replace(/\\'/g, "'"); // Replace escaped single quotes

        return cleaned;
      }

      /**
       * Posts listing page
       * Displays all available posts in a grid
       */

      function PostList() {
        const { posts, isLoading } = React.useContext(GlobalContext);
        const [postData, setPostData] = React.useState([]);
        const [error, setError] = React.useState(null);
        console.log("base url", window.BASE_URL);
        React.useEffect(() => {
          if (!isLoading) {
            Promise.all(
              posts.map(async (file, index) => {
                try {
                  const { content, metadata } = await fetchMarkdown(
                    "posts",
                    file
                  );

                  // Handle image path
                  let imagePath;
                  if (metadata.image) {
                    // If image URL is absolute (starts with http), use it directly
                    imagePath = metadata.image.startsWith("http")
                      ? metadata.image
                      : `${window.BASE_URL}/${metadata.image}`;
                  } else {
                    // Fallback image
                    imagePath = `${window.BASE_URL}/assets/images/book.jpg`;
                  }

                  return {
                    slug: file.replace(".md", ""),
                    title: cleanMetadata(metadata.title) || file.replace(".md", ""),
                    date: metadata.date || "Unknown date",
                    excerpt: cleanMetadata(metadata.excerpt) || "",
                    image: imagePath,
                    author: cleanMetadata(metadata.author) || "Anonymous",
                    tags: metadata.tags || [],
                  };
                } catch (err) {
                  console.error(`Error loading post ${file}:`, err);
                  setError("Failed to load posts");
                  return null;
                }
              })
            ).then((results) => setPostData(results.filter(Boolean)));
          }
        }, [posts, isLoading]);

        if (error) return <ErrorMessage message={error} />;
        if (isLoading) return <LoadingSpinner />;
        if (postData.length === 0)
          return <ErrorMessage message="No posts found" />;

        return (
          <div className="space-y-16 animate-fadeIn">
            {/* Header Section */}
            <section className="relative bg-gradient-to-br from-neutral-50 to-neutral-100 dark:from-neutral-800 dark:to-neutral-900 py-16 -mt-8">
              <div className="absolute inset-0 overflow-hidden">
                <div className="absolute inset-0 bg-[linear-gradient(to_right,#8882_1px,transparent_1px),linear-gradient(to_bottom,#8882_1px,transparent_1px)] bg-[size:14px_24px] [mask-image:radial-gradient(ellipse_60%_50%_at_50%_0%,#000_70%,transparent_110%)]"></div>
              </div>
              <div className="relative max-w-6xl mx-auto px-4 text-center">
                <h1 className="text-4xl md:text-5xl font-bold text-neutral-800 dark:text-neutral-100 mb-4">
                  Latest Posts
                </h1>
                <p className="text-lg text-neutral-600 dark:text-neutral-300 max-w-2xl mx-auto">
                  Explore our collection of thoughts, ideas, and discoveries
                </p>
              </div>
            </section>

            {/* Posts Grid */}
            <section className="max-w-6xl mx-auto px-4">
              <div className="space-y-12">
                {/* Featured Post (First Post) */}
                {postData.length > 0 && (
                  <article className="bg-white dark:bg-neutral-800 rounded-lg shadow-sm overflow-hidden">
                    <div className="md:grid md:grid-cols-2">
                      <div className="relative h-64 md:h-full">
                        <img
                          src={postData[0].image}
                          alt={postData[0].title}
                          className="absolute inset-0 w-full h-full object-cover"
                        />
                      </div>
                      <div className="p-8">
                        <time className="text-sm text-neutral-500 dark:text-neutral-400">
                          {postData[0].date}
                        </time>
                        <h2 className="text-2xl font-bold text-neutral-800 dark:text-neutral-100 mt-2 mb-4">
                          <a
                            href={`#/posts/${postData[0].slug}`}
                            className="hover:text-primary-600 dark:hover:text-primary-400"
                          >
                            {postData[0].title}
                          </a>
                        </h2>
                        {postData[0].excerpt && (
                          <p className="text-neutral-600 dark:text-neutral-300 mb-6">
                            {postData[0].excerpt}
                          </p>
                        )}
                        <a
                          href={`#/posts/${postData[0].slug}`}
                          className="inline-flex items-center text-primary-600 dark:text-primary-400 hover:underline"
                        >
                          Read More
                          <i className="bi bi-arrow-right ml-2"></i>
                        </a>
                      </div>
                    </div>
                  </article>
                )}

                {/* Other Posts */}
                <div className="grid md:grid-cols-2 gap-8">
                  {postData.slice(1).map((post) => (
                    <article
                      key={post.slug}
                      className="bg-white dark:bg-neutral-800 p-6 rounded-lg shadow-sm hover:shadow-md transition-shadow"
                    >
                      <time className="text-sm text-neutral-500 dark:text-neutral-400">
                        {post.date}
                      </time>
                      <h2 className="text-xl font-bold text-neutral-800 dark:text-neutral-100 mt-2 mb-4">
                        <a
                          href={`#/posts/${post.slug}`}
                          className="hover:text-primary-600 dark:hover:text-primary-400"
                        >
                          {post.title}
                        </a>
                      </h2>
                      {post.excerpt && (
                        <p className="text-neutral-600 dark:text-neutral-300 mb-4">
                          {post.excerpt}
                        </p>
                      )}
                      <a
                        href={`#/posts/${post.slug}`}
                        className="inline-flex items-center text-primary-600 dark:text-primary-400 hover:underline"
                      >
                        Read More
                        <i className="bi bi-arrow-right ml-2"></i>
                      </a>
                    </article>
                  ))}
                </div>
              </div>
            </section>
          </div>
        );
      }

      /**
       * Individual post page
       * Renders markdown content for a specific post
       * @param {Object} props
       * @param {string} props.slug - Post identifier
       */
      function Post({ slug }) {
        const [post, setPost] = React.useState(null);
        const [isLoading, setIsLoading] = React.useState(true);
        const [error, setError] = React.useState(null);

        React.useEffect(() => {
          fetchMarkdown("posts", `${slug}.md`)
            .then(({ content, metadata }) => {
              // Match PostList image handling
              let imagePath;
              if (metadata.image) {
                // If image URL is absolute (starts with http), use it directly
                imagePath = metadata.image.startsWith("http")
                  ? metadata.image
                  : `${window.BASE_URL}/${metadata.image}`;
              } else {
                // Fallback image
                imagePath = `${window.BASE_URL}/assets/images/book.jpg`;
              }

              setPost({
                content,
                title: cleanMetadata(metadata.title) || slug,
                date: metadata.date || "Unknown date",
                author: cleanMetadata(metadata.author) || "Anonymous",
                readingTime: calculateReadingTime(content),
                excerpt: cleanMetadata(metadata.excerpt),
                image: imagePath,
                tags: metadata.tags || [],
              });
              setIsLoading(false);
            })
            .catch((err) => {
              console.error("Error loading post:", err);
              setError("Failed to load post");
              setIsLoading(false);
            });
        }, [slug]);

        // Calculate estimated reading time
        function calculateReadingTime(content) {
          const wordsPerMinute = 200;
          const words = content.trim().split(/\s+/).length;
          return Math.ceil(words / wordsPerMinute);
        }

        const components = {
          h1: ({ node, ...props }) => (
            <h1
              className="text-4xl font-bold text-neutral-800 dark:text-neutral-100 mb-6"
              {...props}
            />
          ),
          h2: ({ node, ...props }) => (
            <h2
              className="text-3xl font-semibold text-neutral-700 dark:text-neutral-200 mt-12 mb-4"
              {...props}
            />
          ),
          h3: ({ node, ...props }) => (
            <h3
              className="text-2xl font-medium text-neutral-600 dark:text-neutral-300 mt-8 mb-4"
              {...props}
            />
          ),
          p: ({ node, ...props }) => (
            <p
              className="text-neutral-600 dark:text-neutral-300 leading-relaxed mb-6"
              {...props}
            />
          ),
          a: ({ node, ...props }) => (
            <a
              className="text-primary-600 dark:text-primary-400 hover:underline"
              {...props}
            />
          ),
          blockquote: ({ node, ...props }) => (
            <blockquote
              className="border-l-4 border-primary-500 dark:border-primary-400 pl-6 py-2 my-8 italic"
              {...props}
            />
          ),
          ul: ({ node, ...props }) => (
            <ul className="list-disc pl-6 my-6" {...props} />
          ),
          ol: ({ node, ...props }) => (
            <ol className="list-decimal pl-6 my-6" {...props} />
          ),
          li: ({ node, ...props }) => (
            <li
              className="text-neutral-600 dark:text-neutral-300 my-2"
              {...props}
            />
          ),
          code: ({ node, inline, ...props }) =>
            inline ? (
              <code
                className="bg-neutral-100 dark:bg-neutral-800 px-1.5 py-0.5 rounded"
                {...props}
              />
            ) : (
              <pre className="bg-neutral-50 dark:bg-neutral-900 p-4 rounded-lg my-6 overflow-x-auto">
                <code {...props} />
              </pre>
            ),
          img: ({ node, ...props }) => (
            <img
              className="rounded-lg shadow-md my-8 mx-auto max-h-[500px]"
              {...props}
            />
          ),
          table: ({ node, ...props }) => (
            <div className="my-8 overflow-x-auto">
              <table
                className="w-full border-collapse border border-neutral-200 dark:border-neutral-700"
                {...props}
              />
            </div>
          ),
          thead: ({ node, ...props }) => (
            <thead
              className="bg-neutral-100 dark:bg-neutral-800 border-b border-neutral-200 dark:border-neutral-700"
              {...props}
            />
          ),
          tbody: ({ node, ...props }) => (
            <tbody
              className="divide-y divide-neutral-200 dark:divide-neutral-700 bg-white dark:bg-neutral-900"
              {...props}
            />
          ),
          tr: ({ node, ...props }) => (
            <tr
              className="divide-x divide-neutral-200 dark:divide-neutral-700 hover:bg-neutral-50 dark:hover:bg-neutral-800 transition-colors"
              {...props}
            />
          ),
          th: ({ node, ...props }) => (
            <th
              className="px-4 py-3 text-left font-semibold text-neutral-900 dark:text-neutral-100 border-r border-neutral-200 dark:border-neutral-700 bg-neutral-100 dark:bg-neutral-800"
              {...props}
            />
          ),
          td: ({ node, ...props }) => (
            <td
              className="px-4 py-3 text-neutral-700 dark:text-neutral-300 border-r border-neutral-200 dark:border-neutral-700"
              {...props}
            />
          ),
        };

        if (isLoading) return <LoadingSpinner />;
        if (error) return <ErrorMessage message={error} />;
        if (!post) return <ErrorMessage message="Post not found" />;

        return (
          <div className="max-w-6xl mx-auto animate-fadeIn">
            {/* Article Header */}
            <header className="relative py-16 -mt-8 mb-12 bg-gradient-to-br from-neutral-50 to-neutral-100 dark:from-neutral-800 dark:to-neutral-900">
              <div className="absolute inset-0 overflow-hidden">
                <div className="absolute inset-0 bg-[linear-gradient(to_right,#8882_1px,transparent_1px),linear-gradient(to_bottom,#8882_1px,transparent_1px)] bg-[size:14px_24px] [mask-image:radial-gradient(ellipse_60%_50%_at_50%_0%,#000_70%,transparent_110%)]"></div>
              </div>
              <div className="relative max-w-5xl mx-auto px-4 text-center">
                <h1 className="text-4xl md:text-5xl font-bold text-neutral-800 dark:text-neutral-100 mb-4">
                  {post.title}
                </h1>
                {post.excerpt && (
                  <p className="text-lg text-neutral-600 dark:text-neutral-300 mb-6">
                    {post.excerpt}
                  </p>
                )}
                <div className="flex items-center justify-center space-x-4 text-sm text-neutral-500 dark:text-neutral-400">
                  <div className="flex items-center">
                    <i className="bi bi-person mr-2"></i>
                    <span>{post.author}</span>
                  </div>
                  <div className="flex items-center">
                    <i className="bi bi-calendar3 mr-2"></i>
                    <time>{post.date}</time>
                  </div>
                  <div className="flex items-center">
                    <i className="bi bi-clock mr-2"></i>
                    <span>{post.readingTime} min read</span>
                  </div>
                </div>
              </div>
            </header>

            {/* Main Content */}
            <article className="px-4">
              <div className="max-w-5xl mx-auto">
                {/* Featured Image with improved styling */}
                {post.image && (
                  <div className="mb-12 rounded-xl overflow-hidden shadow-lg">
                    <img
                      src={post.image}
                      alt={post.title}
                      className="w-full h-auto object-cover hover:scale-105 transition-transform duration-300"
                    />
                  </div>
                )}
                <div className="bg-white dark:bg-neutral-800 p-8 md:p-12 rounded-xl shadow-sm">
                  <ReactMarkdown
                    children={post.content}
                    components={components}
                    remarkPlugins={[remarkGfm]}
                    className="prose lg:prose-xl dark:prose-invert max-w-none"
                  />
                </div>

                {/* Article Footer with enhanced navigation */}
                <footer className="mt-12 mb-16 flex flex-col sm:flex-row justify-between items-center gap-4 text-neutral-500 dark:text-neutral-400">
                  <a
                    href="#/posts"
                    className="inline-flex items-center px-4 py-2 rounded-lg bg-neutral-100 dark:bg-neutral-800 hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors"
                  >
                    <i className="bi bi-arrow-left mr-2"></i>
                    Back to Posts
                  </a>
                  <div className="flex items-center gap-4">
                    <button
                      onClick={() =>
                        window.scrollTo({ top: 0, behavior: "smooth" })
                      }
                      className="inline-flex items-center px-4 py-2 rounded-lg bg-neutral-100 dark:bg-neutral-800 hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors"
                    >
                      <i className="bi bi-arrow-up mr-2"></i>
                      Back to Top
                    </button>
                  </div>
                </footer>
              </div>
            </article>
          </div>
        );
      }

      // ===============================================
      // MAIN APP COMPONENT
      // ===============================================

      /**
       * Root application component
       * Handles routing and global state management
       */
      function App() {
        const path = useRouter();

        return (
          <GlobalProvider>
            <Layout>
              {path === "#/" && <Home />}
              {path === "#/about" && <About />}
              {path === "#/posts" && <PostList />}
              {path.startsWith("#/posts/") && (
                <Post slug={path.split("/")[2]} />
              )}
            </Layout>
          </GlobalProvider>
        );
      }

      // ===============================================
      // MOUNT THE APP
      // ===============================================

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
